# LINT-ERROR
- name: "Helm List"
  command: kubectl get ns
  become: yes
  become_user: root
  register: ns_list
  changed_when: False

- name: "Create the namespace for ingress-nginx"
  command: kubectl create namespace nginx-ingress
  become: yes
  become_user: root
  when: "'nginx-ingress' not in ns_list.stdout"

- name: "Create folder /root/nginx-ingress"
  file:
    path: /root/nginx-ingress
    state: directory
    mode: 0755
  become: yes
  become_user: root

- name: "Configure nginx-ingress"
  template:
    src: kustomization.yaml
    dest: /root/nginx-ingress/kustomization.yaml
  become: yes
  become_user: root
  when: registry is defined

- name: "Kustomize nginx-ingress"
  command: kubectl apply --kustomize /root/nginx-ingress
  become: yes
  become_user: root

#- name: "Install the cert-manager Helm chart"
#  command: /usr/local/bin/helm install --name nginx-ingress --namespace nginx-ingress --set webhook.enabled=false stable/nginx-ingress
#  become: yes
#  become_user: root
#  when: "'nginx-ingress' not in helm_list.stdout"

#- name: Copy Resources
#  template:
#    src: "templates/patch.yml"
#    dest: "/tmp/patch.yml"

# LINT-ERROR
#- name: Patch ConfigMap
#  shell: kubectl patch configmap nginx-configuration -n ingress-nginx --patch "$(cat /tmp/patch.yml)"
#  ignore_errors: True
#  become: yes
